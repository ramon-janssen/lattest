<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE MultiParamTypeClasses #-}</span><span>
</span><span id="line-2"></span><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><span id="line-3"></span><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><span id="line-4"></span><span>
</span><span id="line-5"></span><span class="annot"><span class="hs-comment">{- |
    This module contains the main functions and data structures to run experiments against (external) systems, specifically testing
    experiments.
    
    For an experiment, we assume that we have an 'Adapter', which serves as an interface to send inputs to a system under test,
    and observe actions shown by that system. The experiment is controlled by an 'ActionController'. Specifically for a testing
    experiment, we also assume that we have a specification model that dictates which observations are allowed and forbidden, and a test
    controller that steers the testing.
    
    To get started with testing experiments quickly, use the 'runTester' function, and to get the required ingredients, see the following modules:
    
    * &quot;Lattest.Adapter.StandardAdapters&quot; to create adapters,
    * &quot;Lattest.Exec.StandardTestControllers&quot; to create test controllers, and
    * &quot;Lattest.Model.StandardAutomata&quot; to create specification models.
-}</span></span><span>
</span><span id="line-20"></span><span>
</span><span id="line-21"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Lattest.Exec.Testing</span><span> </span><span class="hs-special">(</span><span>
</span><span id="line-22"></span><span class="annot"><span class="hs-comment">-- * Generic Experiments</span></span><span>
</span><span id="line-23"></span><span class="annot"><span class="hs-comment">-- | Can be used to let an action controller communicate with a system under test, resulting in some arbitrary result.</span></span><span>
</span><span id="line-24"></span><span class="annot"><a href="Lattest.Exec.Testing.html#ActionController"><span class="hs-identifier">ActionController</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-25"></span><span class="annot"><a href="Lattest.Exec.Testing.html#runExperiment"><span class="hs-identifier">runExperiment</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-26"></span><span class="annot"><span class="hs-comment">-- * Testing Experiments</span></span><span>
</span><span id="line-27"></span><span class="annot"><span class="hs-comment">{- |
    Specific form of experiments, in which an automaton specification model describes the intended behaviour that the system under
    test should adhere to, and the test controller sends inputs to observe whether the system under test actually conforms to that
    specification model.
    
    This is also known as /Model based testing/, see e.g.
    
    * [/Jan Tretmans/, Model based testing with labelled transition systems (Formal Methods and Testing), 2008](https://repository.ubn.ru.nl/bitstream/handle/2066/72680/72680.pdf)
-}</span></span><span>
</span><span id="line-36"></span><span class="annot"><a href="Lattest.Exec.Testing.html#TestController"><span class="hs-identifier">TestController</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-37"></span><span class="annot"><a href="Lattest.Exec.Testing.html#makeTester"><span class="hs-identifier">makeTester</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-38"></span><span class="annot"><a href="Lattest.Exec.Testing.html#runTester"><span class="hs-identifier">runTester</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-39"></span><span class="annot"><a href="Lattest.Exec.Testing.html#Verdict"><span class="hs-identifier">Verdict</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-40"></span><span class="annot"><a href="Lattest.Exec.Testing.html#InconclusiveReason"><span class="hs-identifier">InconclusiveReason</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-41"></span><span class="hs-special">)</span><span>
</span><span id="line-42"></span><span class="hs-keyword">where</span><span>
</span><span id="line-43"></span><span>
</span><span id="line-44"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Lattest.Model.Alphabet.html"><span class="hs-identifier">Lattest.Model.Alphabet</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Alphabet.html#TestChoice"><span class="hs-identifier">TestChoice</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.Alphabet.html#Refusable"><span class="hs-identifier">Refusable</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.Alphabet.html#isAccepted"><span class="hs-identifier">isAccepted</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-45"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Lattest.Model.Automaton.html"><span class="hs-identifier">Lattest.Model.Automaton</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Automaton.html#StepSemantics"><span class="hs-identifier">StepSemantics</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.Automaton.html#AutIntrpr"><span class="hs-identifier">AutIntrpr</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.Automaton.html#after"><span class="hs-identifier">after</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.Automaton.html#stateConf"><span class="hs-identifier">stateConf</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.Automaton.html#AutomatonException"><span class="hs-identifier">AutomatonException</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-46"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Lattest.Model.BoundedMonad.html"><span class="hs-identifier">Lattest.Model.BoundedMonad</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.BoundedMonad.html#BoundedConfiguration"><span class="hs-identifier">BoundedConfiguration</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.BoundedMonad.html#isConclusive"><span class="hs-identifier">isConclusive</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.BoundedMonad.html#isForbidden"><span class="hs-identifier">isForbidden</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-47"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Lattest.Adapter.Adapter.html"><span class="hs-identifier">Lattest.Adapter.Adapter</span></a></span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Adapter.Adapter.html#Adapter"><span class="hs-identifier">Adapter</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Adapter.Adapter.html#send"><span class="hs-identifier">send</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Adapter.Adapter.html#tryObserve"><span class="hs-identifier">tryObserve</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-48"></span><span>
</span><span id="line-49"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Exception</span></span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">catch</span></span><span class="hs-special">,</span><span class="annot"><span class="hs-identifier">evaluate</span></span><span class="hs-special">)</span><span>
</span><span id="line-50"></span><span class="hs-comment">--import Control.DeepSeq(force)</span><span>
</span><span id="line-51"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="System.IO.Streams.Synchronized.html"><span class="hs-identifier">System.IO.Streams.Synchronized</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="System.IO.Streams.Synchronized.html#Streamed"><span class="hs-identifier">Streamed</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-52"></span><span>
</span><span id="line-53"></span><span class="annot"><span class="hs-comment">-- | The controller of an experiment.</span></span><span>
</span><span id="line-54"></span><span class="hs-keyword">data</span><span> </span><span id="ActionController"><span class="annot"><a href="Lattest.Exec.Testing.html#ActionController"><span class="hs-identifier hs-var">ActionController</span></a></span></span><span> </span><span id="local-6989586621679297389"><span class="annot"><a href="#local-6989586621679297389"><span class="hs-identifier hs-type">act</span></a></span></span><span> </span><span id="local-6989586621679297390"><span class="annot"><a href="#local-6989586621679297390"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621679297391"><span class="annot"><a href="#local-6989586621679297391"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span id="local-6989586621679297392"><span class="annot"><a href="#local-6989586621679297392"><span class="hs-identifier hs-type">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="ActionController"><span class="annot"><a href="Lattest.Exec.Testing.html#ActionController"><span class="hs-identifier hs-var">ActionController</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-55"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Any state that the controller needs for its decision making duties.</span></span><span>
</span><span id="line-56"></span><span>    </span><span id="controllerState"><span class="annot"><span class="annottext">forall act i r state. ActionController act i r state -&gt; state
</span><a href="Lattest.Exec.Testing.html#controllerState"><span class="hs-identifier hs-var hs-var">controllerState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679297392"><span class="hs-identifier hs-type">state</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-57"></span><span>     </span><span class="annot"><span class="hs-comment">-- | Select an input and compute the new state, /or/ decide to stop the experiment and return a result.</span></span><span>
</span><span id="line-58"></span><span>    </span><span id="select"><span class="annot"><span class="annottext">forall act i r state.
ActionController act i r state -&gt; state -&gt; IO (Either (i, state) r)
</span><a href="Lattest.Exec.Testing.html#select"><span class="hs-identifier hs-var hs-var">select</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679297392"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679297390"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679297392"><span class="hs-identifier hs-type">state</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679297391"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-59"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Provided an observed action, compute the new state /or/ stop the experiment and return a result.</span></span><span>
</span><span id="line-60"></span><span>    </span><span id="update"><span class="annot"><span class="annottext">forall act i r state.
ActionController act i r state
-&gt; state -&gt; act -&gt; IO (Either state r)
</span><a href="Lattest.Exec.Testing.html#update"><span class="hs-identifier hs-var hs-var">update</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679297392"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679297389"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679297392"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297391"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-61"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Handle the end of the action stream, i.e. the other end closing, ending the experiment.</span></span><span>
</span><span id="line-62"></span><span>    </span><span id="handleClose"><span class="annot"><span class="annottext">forall act i r state.
ActionController act i r state -&gt; state -&gt; IO r
</span><a href="Lattest.Exec.Testing.html#handleClose"><span class="hs-identifier hs-var hs-var">handleClose</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679297392"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679297391"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-63"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-64"></span><span>
</span><span id="line-65"></span><span class="annot"><span class="hs-comment">-- | The verdict resulting from a testing experiment: did the system under test pass the test?</span></span><span>
</span><span id="line-66"></span><span class="hs-keyword">data</span><span> </span><span id="Verdict"><span class="annot"><a href="Lattest.Exec.Testing.html#Verdict"><span class="hs-identifier hs-var">Verdict</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Pass"><span class="annot"><a href="Lattest.Exec.Testing.html#Pass"><span class="hs-identifier hs-var">Pass</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Fail"><span class="annot"><a href="Lattest.Exec.Testing.html#Fail"><span class="hs-identifier hs-var">Fail</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Inconclusive"><span class="annot"><a href="Lattest.Exec.Testing.html#Inconclusive"><span class="hs-identifier hs-var">Inconclusive</span></a></span></span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#InconclusiveReason"><span class="hs-identifier hs-type">InconclusiveReason</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679297665"><span id="local-6989586621679297669"><span id="local-6989586621679297672"><span id="local-6989586621679297676"><span id="local-6989586621679297679"><span id="local-6989586621679297682"><span id="local-6989586621679297685"><span class="annot"><span class="annottext">Eq Verdict
Eq Verdict =&gt;
(Verdict -&gt; Verdict -&gt; Ordering)
-&gt; (Verdict -&gt; Verdict -&gt; Bool)
-&gt; (Verdict -&gt; Verdict -&gt; Bool)
-&gt; (Verdict -&gt; Verdict -&gt; Bool)
-&gt; (Verdict -&gt; Verdict -&gt; Bool)
-&gt; (Verdict -&gt; Verdict -&gt; Verdict)
-&gt; (Verdict -&gt; Verdict -&gt; Verdict)
-&gt; Ord Verdict
Verdict -&gt; Verdict -&gt; Bool
Verdict -&gt; Verdict -&gt; Ordering
Verdict -&gt; Verdict -&gt; Verdict
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: Verdict -&gt; Verdict -&gt; Ordering
compare :: Verdict -&gt; Verdict -&gt; Ordering
$c&lt; :: Verdict -&gt; Verdict -&gt; Bool
&lt; :: Verdict -&gt; Verdict -&gt; Bool
$c&lt;= :: Verdict -&gt; Verdict -&gt; Bool
&lt;= :: Verdict -&gt; Verdict -&gt; Bool
$c&gt; :: Verdict -&gt; Verdict -&gt; Bool
&gt; :: Verdict -&gt; Verdict -&gt; Bool
$c&gt;= :: Verdict -&gt; Verdict -&gt; Bool
&gt;= :: Verdict -&gt; Verdict -&gt; Bool
$cmax :: Verdict -&gt; Verdict -&gt; Verdict
max :: Verdict -&gt; Verdict -&gt; Verdict
$cmin :: Verdict -&gt; Verdict -&gt; Verdict
min :: Verdict -&gt; Verdict -&gt; Verdict
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679297689"><span id="local-6989586621679297693"><span class="annot"><span class="annottext">Verdict -&gt; Verdict -&gt; Bool
(Verdict -&gt; Verdict -&gt; Bool)
-&gt; (Verdict -&gt; Verdict -&gt; Bool) -&gt; Eq Verdict
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: Verdict -&gt; Verdict -&gt; Bool
== :: Verdict -&gt; Verdict -&gt; Bool
$c/= :: Verdict -&gt; Verdict -&gt; Bool
/= :: Verdict -&gt; Verdict -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679297697"><span id="local-6989586621679297703"><span id="local-6989586621679297707"><span class="annot"><span class="annottext">Int -&gt; Verdict -&gt; ShowS
[Verdict] -&gt; ShowS
Verdict -&gt; String
(Int -&gt; Verdict -&gt; ShowS)
-&gt; (Verdict -&gt; String) -&gt; ([Verdict] -&gt; ShowS) -&gt; Show Verdict
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; Verdict -&gt; ShowS
showsPrec :: Int -&gt; Verdict -&gt; ShowS
$cshow :: Verdict -&gt; String
show :: Verdict -&gt; String
$cshowList :: [Verdict] -&gt; ShowS
showList :: [Verdict] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-67"></span><span>
</span><span id="line-68"></span><span class="annot"><span class="hs-comment">-- | In case of an inconclusive verdict, details on why the test is inconclusive</span></span><span>
</span><span id="line-69"></span><span class="hs-keyword">data</span><span> </span><span id="InconclusiveReason"><span class="annot"><a href="Lattest.Exec.Testing.html#InconclusiveReason"><span class="hs-identifier hs-var">InconclusiveReason</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="AutomatonException"><span class="annot"><a href="Lattest.Exec.Testing.html#AutomatonException"><span class="hs-identifier hs-var">AutomatonException</span></a></span></span><span> </span><span class="annot"><a href="Lattest.Model.Automaton.html#AutomatonException"><span class="hs-identifier hs-type">AutomatonException</span></a></span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679297714"><span id="local-6989586621679297718"><span id="local-6989586621679297721"><span id="local-6989586621679297724"><span id="local-6989586621679297727"><span id="local-6989586621679297730"><span id="local-6989586621679297733"><span class="annot"><span class="annottext">Eq InconclusiveReason
Eq InconclusiveReason =&gt;
(InconclusiveReason -&gt; InconclusiveReason -&gt; Ordering)
-&gt; (InconclusiveReason -&gt; InconclusiveReason -&gt; Bool)
-&gt; (InconclusiveReason -&gt; InconclusiveReason -&gt; Bool)
-&gt; (InconclusiveReason -&gt; InconclusiveReason -&gt; Bool)
-&gt; (InconclusiveReason -&gt; InconclusiveReason -&gt; Bool)
-&gt; (InconclusiveReason -&gt; InconclusiveReason -&gt; InconclusiveReason)
-&gt; (InconclusiveReason -&gt; InconclusiveReason -&gt; InconclusiveReason)
-&gt; Ord InconclusiveReason
InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
InconclusiveReason -&gt; InconclusiveReason -&gt; Ordering
InconclusiveReason -&gt; InconclusiveReason -&gt; InconclusiveReason
forall a.
Eq a =&gt;
(a -&gt; a -&gt; Ordering)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; Bool)
-&gt; (a -&gt; a -&gt; a)
-&gt; (a -&gt; a -&gt; a)
-&gt; Ord a
$ccompare :: InconclusiveReason -&gt; InconclusiveReason -&gt; Ordering
compare :: InconclusiveReason -&gt; InconclusiveReason -&gt; Ordering
$c&lt; :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
&lt; :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
$c&lt;= :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
&lt;= :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
$c&gt; :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
&gt; :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
$c&gt;= :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
&gt;= :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
$cmax :: InconclusiveReason -&gt; InconclusiveReason -&gt; InconclusiveReason
max :: InconclusiveReason -&gt; InconclusiveReason -&gt; InconclusiveReason
$cmin :: InconclusiveReason -&gt; InconclusiveReason -&gt; InconclusiveReason
min :: InconclusiveReason -&gt; InconclusiveReason -&gt; InconclusiveReason
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Ord</span></span></span></span></span></span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679297736"><span id="local-6989586621679297740"><span class="annot"><span class="annottext">InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
(InconclusiveReason -&gt; InconclusiveReason -&gt; Bool)
-&gt; (InconclusiveReason -&gt; InconclusiveReason -&gt; Bool)
-&gt; Eq InconclusiveReason
forall a. (a -&gt; a -&gt; Bool) -&gt; (a -&gt; a -&gt; Bool) -&gt; Eq a
$c== :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
== :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
$c/= :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
/= :: InconclusiveReason -&gt; InconclusiveReason -&gt; Bool
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var">Eq</span></span></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679297743"><span id="local-6989586621679297748"><span id="local-6989586621679297751"><span class="annot"><span class="annottext">Int -&gt; InconclusiveReason -&gt; ShowS
[InconclusiveReason] -&gt; ShowS
InconclusiveReason -&gt; String
(Int -&gt; InconclusiveReason -&gt; ShowS)
-&gt; (InconclusiveReason -&gt; String)
-&gt; ([InconclusiveReason] -&gt; ShowS)
-&gt; Show InconclusiveReason
forall a.
(Int -&gt; a -&gt; ShowS) -&gt; (a -&gt; String) -&gt; ([a] -&gt; ShowS) -&gt; Show a
$cshowsPrec :: Int -&gt; InconclusiveReason -&gt; ShowS
showsPrec :: Int -&gt; InconclusiveReason -&gt; ShowS
$cshow :: InconclusiveReason -&gt; String
show :: InconclusiveReason -&gt; String
$cshowList :: [InconclusiveReason] -&gt; ShowS
showList :: [InconclusiveReason] -&gt; ShowS
</span><span class="hs-identifier hs-var hs-var hs-var hs-var hs-var hs-var hs-var hs-var">Show</span></span></span></span></span><span class="hs-special">)</span><span>
</span><span id="line-70"></span><span>
</span><span id="line-71"></span><span class="annot"><span class="hs-comment">{- |
    The controller of a testing experiment. The tester may return a result at the end of a testing experiment. Note that it does
    /not/ need to return a verdict 'Pass' or 'Fail', this verdict is automatically inferred based on the specification model.
    Results can be used to record additional information that the tester is interested in, depending on the controller implementation.
    For example, the actions observed during a testing experiment, or whether certain coverage criteria were achieved during the experiment.
-}</span></span><span> </span><span>
</span><span id="line-77"></span><span class="hs-keyword">data</span><span> </span><span id="TestController"><span class="annot"><a href="Lattest.Exec.Testing.html#TestController"><span class="hs-identifier hs-var">TestController</span></a></span></span><span> </span><span id="local-6989586621679297417"><span class="annot"><a href="#local-6989586621679297417"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679297418"><span class="annot"><a href="#local-6989586621679297418"><span class="hs-identifier hs-type">loc</span></a></span></span><span> </span><span id="local-6989586621679297419"><span class="annot"><a href="#local-6989586621679297419"><span class="hs-identifier hs-type">q</span></a></span></span><span> </span><span id="local-6989586621679297420"><span class="annot"><a href="#local-6989586621679297420"><span class="hs-identifier hs-type">t</span></a></span></span><span> </span><span id="local-6989586621679297421"><span class="annot"><a href="#local-6989586621679297421"><span class="hs-identifier hs-type">tdest</span></a></span></span><span> </span><span id="local-6989586621679297422"><span class="annot"><a href="#local-6989586621679297422"><span class="hs-identifier hs-type">act</span></a></span></span><span> </span><span id="local-6989586621679297423"><span class="annot"><a href="#local-6989586621679297423"><span class="hs-identifier hs-type">state</span></a></span></span><span> </span><span id="local-6989586621679297424"><span class="annot"><a href="#local-6989586621679297424"><span class="hs-identifier hs-type">i</span></a></span></span><span> </span><span id="local-6989586621679297425"><span class="annot"><a href="#local-6989586621679297425"><span class="hs-identifier hs-type">r</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="TestController"><span class="annot"><a href="Lattest.Exec.Testing.html#TestController"><span class="hs-identifier hs-var">TestController</span></a></span></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-78"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Any state that the controller needs for its decision making duties.</span></span><span>
</span><span id="line-79"></span><span>    </span><span id="testControllerState"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r -&gt; state
</span><a href="Lattest.Exec.Testing.html#testControllerState"><span class="hs-identifier hs-var hs-var">testControllerState</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679297423"><span class="hs-identifier hs-type">state</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-80"></span><span>    </span><span class="annot"><span class="hs-comment">{- |
        Select a test based on test controller state, the specification (in its current state), and previous specification configuration.
        Either select a new controller state and a input, /or/ stop testing and return a result from the controller.
    -}</span></span><span>
</span><span id="line-84"></span><span>    </span><span id="selectTest"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r
-&gt; TestChoice i act =&gt;
   state
   -&gt; AutIntrpr m loc q t tdest act -&gt; m q -&gt; IO (Either (i, state) r)
</span><a href="Lattest.Exec.Testing.html#selectTest"><span class="hs-identifier hs-var hs-var">selectTest</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Alphabet.html#TestChoice"><span class="hs-identifier hs-type">TestChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297424"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297422"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679297423"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lattest.Model.Automaton.html#AutIntrpr"><span class="hs-identifier hs-type">AutIntrpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297417"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297418"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297419"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297420"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297421"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297422"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679297417"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297419"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679297424"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679297423"><span class="hs-identifier hs-type">state</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679297425"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-85"></span><span>    </span><span class="annot"><span class="hs-comment">{- |
        Select a test based on test controller state, the specification (in its current state), an observed action, and previous specification
        configuration. Either select a new controller state, /or/ stop testing and return a result from the controller.
    -}</span></span><span>
</span><span id="line-89"></span><span>    </span><span id="updateTestController"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r
-&gt; state
-&gt; AutIntrpr m loc q t tdest act
-&gt; act
-&gt; m q
-&gt; IO (Either state r)
</span><a href="Lattest.Exec.Testing.html#updateTestController"><span class="hs-identifier hs-var hs-var">updateTestController</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679297423"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lattest.Model.Automaton.html#AutIntrpr"><span class="hs-identifier hs-type">AutIntrpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297417"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297418"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297419"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297420"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297421"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297422"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679297422"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679297417"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297419"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679297423"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297425"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-90"></span><span>    </span><span class="annot"><span class="hs-comment">-- | Handle the end of the action stream, i.e. the other end closing, ending the experiment.</span></span><span>
</span><span id="line-91"></span><span>    </span><span id="handleTestClose"><span class="annot"><span class="annottext">forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r -&gt; state -&gt; IO r
</span><a href="Lattest.Exec.Testing.html#handleTestClose"><span class="hs-identifier hs-var hs-var">handleTestClose</span></a></span></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679297423"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679297425"><span class="hs-identifier hs-type">r</span></a></span><span>
</span><span id="line-92"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-93"></span><span>
</span><span id="line-94"></span><span class="annot"><span class="hs-comment">{- |
    From a test controller and a specification model, create an action controller. The test controller is used to decide which inputs
    are supplied to the system under test, and whether to continue or stop testing. The automaton specification model is used to infer whether
    observed actions are allowed or not, and to return a verdict in case of forbidden or underspecified observations.
-}</span></span><span>
</span><span id="line-99"></span><span id="local-6989586621679297464"><span id="local-6989586621679297465"><span id="local-6989586621679297466"><span id="local-6989586621679297467"><span id="local-6989586621679297468"><span id="local-6989586621679297469"><span id="local-6989586621679297471"><span id="local-6989586621679297473"><span id="local-6989586621679297474"><span class="annot"><a href="Lattest.Exec.Testing.html#makeTester"><span class="hs-identifier hs-type">makeTester</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Automaton.html#StepSemantics"><span class="hs-identifier hs-type">StepSemantics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297464"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297465"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297466"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297467"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297468"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297469"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.Alphabet.html#TestChoice"><span class="hs-identifier hs-type">TestChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297471"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297469"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.BoundedMonad.html#BoundedConfiguration"><span class="hs-identifier hs-type">BoundedConfiguration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297464"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-100"></span><span>    </span><span class="annot"><a href="Lattest.Model.Automaton.html#AutIntrpr"><span class="hs-identifier hs-type">AutIntrpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297464"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297465"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297466"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297467"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297468"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297469"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#TestController"><span class="hs-identifier hs-type">TestController</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297464"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297465"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297466"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297467"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297468"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297469"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297473"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297471"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297474"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#ActionController"><span class="hs-identifier hs-type">ActionController</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297469"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297471"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Exec.Testing.html#Verdict"><span class="hs-identifier hs-type">Verdict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679297474"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Automaton.html#AutIntrpr"><span class="hs-identifier hs-type">AutIntrpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297464"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297465"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297466"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297467"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297468"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297469"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#TestController"><span class="hs-identifier hs-type">TestController</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297464"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297465"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297466"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297467"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297468"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297469"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297473"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297471"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297474"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-101"></span><span id="makeTester"><span class="annot"><span class="annottext">makeTester :: forall (m :: * -&gt; *) loc q t tdest act i state r.
(StepSemantics m loc q t tdest act, TestChoice i act,
 BoundedConfiguration m) =&gt;
AutIntrpr m loc q t tdest act
-&gt; TestController m loc q t tdest act state i r
-&gt; ActionController
     act
     i
     (Verdict, r)
     (AutIntrpr m loc q t tdest act,
      TestController m loc q t tdest act state i r)
</span><a href="Lattest.Exec.Testing.html#makeTester"><span class="hs-identifier hs-var hs-var">makeTester</span></a></span></span><span> </span><span id="local-6989586621679297771"><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297771"><span class="hs-identifier hs-var">initSpec</span></a></span></span><span> </span><span id="local-6989586621679297772"><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297772"><span class="hs-identifier hs-var">initTestController</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#ActionController"><span class="hs-identifier hs-type">ActionController</span></a></span><span> </span><span class="hs-special">{</span><span>
</span><span id="line-102"></span><span>    </span><span class="annot"><span class="annottext">controllerState :: (AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
</span><a href="Lattest.Exec.Testing.html#controllerState"><span class="hs-identifier hs-var">controllerState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297771"><span class="hs-identifier hs-var">initSpec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297772"><span class="hs-identifier hs-var">initTestController</span></a></span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><span id="line-103"></span><span>    </span><span class="annot"><span class="annottext">select :: (AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; IO
     (Either
        (i,
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r))
        (Verdict, r))
</span><a href="Lattest.Exec.Testing.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; IO
     (Either
        (i,
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r))
        (Verdict, r))
forall i act (m :: * -&gt; *) loc q t tdest state r.
(TestChoice i act, BoundedConfiguration m) =&gt;
(AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; IO
     (Either
        (i,
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r))
        (Verdict, r))
</span><a href="#local-6989586621679297773"><span class="hs-identifier hs-var">makeSelect</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-104"></span><span>    </span><span class="annot"><span class="annottext">update :: (AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; act
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
</span><a href="Lattest.Exec.Testing.html#update"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; act
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
forall (m :: * -&gt; *) loc q t tdest act state i r.
(StepSemantics m loc q t tdest act, BoundedConfiguration m,
 Refusable act) =&gt;
(AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; act
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
</span><a href="#local-6989586621679297774"><span class="hs-identifier hs-var">makeUpdate</span></a></span><span class="hs-special">,</span><span>
</span><span id="line-105"></span><span>    </span><span class="annot"><span class="annottext">handleClose :: (AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; IO (Verdict, r)
</span><a href="Lattest.Exec.Testing.html#handleClose"><span class="hs-identifier hs-var">handleClose</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; IO (Verdict, r)
forall (m :: * -&gt; *) loc q t tdest act state i r.
BoundedConfiguration m =&gt;
(AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; IO (Verdict, r)
</span><a href="#local-6989586621679297775"><span class="hs-identifier hs-var">makeHandleClose</span></a></span><span>
</span><span id="line-106"></span><span>    </span><span class="hs-special">}</span><span>
</span><span id="line-107"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-108"></span><span>        </span><span id="local-6989586621679297487"><span id="local-6989586621679297488"><span id="local-6989586621679297489"><span id="local-6989586621679297490"><span id="local-6989586621679297491"><span id="local-6989586621679297492"><span id="local-6989586621679297493"><span id="local-6989586621679297494"><span id="local-6989586621679297495"><span class="annot"><a href="#local-6989586621679297773"><span class="hs-identifier hs-type">makeSelect</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Alphabet.html#TestChoice"><span class="hs-identifier hs-type">TestChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297487"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297488"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.BoundedMonad.html#BoundedConfiguration"><span class="hs-identifier hs-type">BoundedConfiguration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297489"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-109"></span><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Automaton.html#AutIntrpr"><span class="hs-identifier hs-type">AutIntrpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297489"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297490"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297491"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297492"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297493"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297488"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#TestController"><span class="hs-identifier hs-type">TestController</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297489"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297490"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297491"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297492"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297493"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297488"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297494"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297487"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297495"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-110"></span><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679297487"><span class="hs-identifier hs-type">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Automaton.html#AutIntrpr"><span class="hs-identifier hs-type">AutIntrpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297489"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297490"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297491"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297492"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297493"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297488"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#TestController"><span class="hs-identifier hs-type">TestController</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297489"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297490"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297491"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297492"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297493"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297488"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297494"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297487"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297495"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Exec.Testing.html#Verdict"><span class="hs-identifier hs-type">Verdict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679297495"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-111"></span><span>        </span><span id="local-6989586621679297773"><span class="annot"><span class="annottext">makeSelect :: forall i act (m :: * -&gt; *) loc q t tdest state r.
(TestChoice i act, BoundedConfiguration m) =&gt;
(AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; IO
     (Either
        (i,
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r))
        (Verdict, r))
</span><a href="#local-6989586621679297773"><span class="hs-identifier hs-var hs-var">makeSelect</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679297783"><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297783"><span class="hs-identifier hs-var">spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679297784"><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297784"><span class="hs-identifier hs-var">testController</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-112"></span><span>            </span><span id="local-6989586621679297785"><span class="annot"><span class="annottext">Either (i, state) r
</span><a href="#local-6989586621679297785"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
-&gt; TestChoice i act =&gt;
   state
   -&gt; AutIntrpr m loc q t tdest act -&gt; m q -&gt; IO (Either (i, state) r)
forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r
-&gt; TestChoice i act =&gt;
   state
   -&gt; AutIntrpr m loc q t tdest act -&gt; m q -&gt; IO (Either (i, state) r)
</span><a href="Lattest.Exec.Testing.html#selectTest"><span class="hs-identifier hs-var">selectTest</span></a></span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297784"><span class="hs-identifier hs-var">testController</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r -&gt; state
forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r -&gt; state
</span><a href="Lattest.Exec.Testing.html#testControllerState"><span class="hs-identifier hs-var">testControllerState</span></a></span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297784"><span class="hs-identifier hs-var">testController</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297783"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act -&gt; m q
forall {k} (m :: * -&gt; *) loc q t tdest (act :: k).
AutIntrpr m loc q t tdest act -&gt; m q
</span><a href="Lattest.Model.Automaton.html#stateConf"><span class="hs-identifier hs-var">stateConf</span></a></span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297783"><span class="hs-identifier hs-var">spec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-113"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (i, state) r
</span><a href="#local-6989586621679297785"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-114"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679297786"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297786"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (i,
   (AutIntrpr m loc q t tdest act,
    TestController m loc q t tdest act state i r))
  (Verdict, r)
-&gt; IO
     (Either
        (i,
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r))
        (Verdict, r))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either
   (i,
    (AutIntrpr m loc q t tdest act,
     TestController m loc q t tdest act state i r))
   (Verdict, r)
 -&gt; IO
      (Either
         (i,
          (AutIntrpr m loc q t tdest act,
           TestController m loc q t tdest act state i r))
         (Verdict, r)))
-&gt; Either
     (i,
      (AutIntrpr m loc q t tdest act,
       TestController m loc q t tdest act state i r))
     (Verdict, r)
-&gt; IO
     (Either
        (i,
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r))
        (Verdict, r))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Verdict, r)
-&gt; Either
     (i,
      (AutIntrpr m loc q t tdest act,
       TestController m loc q t tdest act state i r))
     (Verdict, r)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m q -&gt; Verdict
forall {k} (m :: k -&gt; *) (x :: k).
BoundedConfiguration m =&gt;
m x -&gt; Verdict
</span><a href="#local-6989586621679297787"><span class="hs-identifier hs-var">pToVerd</span></a></span><span> </span><span class="annot"><span class="annottext">(m q -&gt; Verdict) -&gt; m q -&gt; Verdict
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act -&gt; m q
forall {k} (m :: * -&gt; *) loc q t tdest (act :: k).
AutIntrpr m loc q t tdest act -&gt; m q
</span><a href="Lattest.Model.Automaton.html#stateConf"><span class="hs-identifier hs-var">stateConf</span></a></span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297783"><span class="hs-identifier hs-var">spec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297786"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-115"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679297788"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679297788"><span class="hs-identifier hs-var">i</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679297789"><span class="annot"><span class="annottext">state
</span><a href="#local-6989586621679297789"><span class="hs-identifier hs-var">state'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (i,
   (AutIntrpr m loc q t tdest act,
    TestController m loc q t tdest act state i r))
  (Verdict, r)
-&gt; IO
     (Either
        (i,
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r))
        (Verdict, r))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either
   (i,
    (AutIntrpr m loc q t tdest act,
     TestController m loc q t tdest act state i r))
   (Verdict, r)
 -&gt; IO
      (Either
         (i,
          (AutIntrpr m loc q t tdest act,
           TestController m loc q t tdest act state i r))
         (Verdict, r)))
-&gt; Either
     (i,
      (AutIntrpr m loc q t tdest act,
       TestController m loc q t tdest act state i r))
     (Verdict, r)
-&gt; IO
     (Either
        (i,
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r))
        (Verdict, r))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(i,
 (AutIntrpr m loc q t tdest act,
  TestController m loc q t tdest act state i r))
-&gt; Either
     (i,
      (AutIntrpr m loc q t tdest act,
       TestController m loc q t tdest act state i r))
     (Verdict, r)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679297788"><span class="hs-identifier hs-var">i</span></a></span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297783"><span class="hs-identifier hs-var">spec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297784"><span class="hs-identifier hs-var">testController</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#testControllerState"><span class="hs-identifier hs-var">testControllerState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679297789"><span class="hs-identifier hs-type">state'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-116"></span><span class="hs-comment">--            return $ case next of</span><span>
</span><span id="line-117"></span><span class="hs-comment">--                Right r -&gt; Right (pToVerd $ stateConf spec, r)</span><span>
</span><span id="line-118"></span><span class="hs-comment">--                Left (i, state') -&gt; Left (i, (spec, testController { testControllerState = state' }))</span><span>
</span><span id="line-119"></span><span>        </span><span id="local-6989586621679297496"><span id="local-6989586621679297497"><span id="local-6989586621679297498"><span id="local-6989586621679297499"><span id="local-6989586621679297500"><span id="local-6989586621679297501"><span id="local-6989586621679297502"><span id="local-6989586621679297503"><span id="local-6989586621679297504"><span class="annot"><a href="#local-6989586621679297774"><span class="hs-identifier hs-type">makeUpdate</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Automaton.html#StepSemantics"><span class="hs-identifier hs-type">StepSemantics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297496"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297497"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297498"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297499"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297500"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297501"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.BoundedMonad.html#BoundedConfiguration"><span class="hs-identifier hs-type">BoundedConfiguration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297496"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.Alphabet.html#Refusable"><span class="hs-identifier hs-type">Refusable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297501"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-120"></span><span>            </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Automaton.html#AutIntrpr"><span class="hs-identifier hs-type">AutIntrpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297496"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297497"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297498"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297499"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297500"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297501"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#TestController"><span class="hs-identifier hs-type">TestController</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297496"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297497"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297498"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297499"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297500"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297501"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297502"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297503"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297504"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679297501"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Automaton.html#AutIntrpr"><span class="hs-identifier hs-type">AutIntrpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297496"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297497"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297498"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297499"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297500"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297501"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#TestController"><span class="hs-identifier hs-type">TestController</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297496"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297497"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297498"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297499"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297500"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297501"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297502"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297503"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297504"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Exec.Testing.html#Verdict"><span class="hs-identifier hs-type">Verdict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679297504"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-121"></span><span>        </span><span id="local-6989586621679297774"><span class="annot"><span class="annottext">makeUpdate :: forall (m :: * -&gt; *) loc q t tdest act state i r.
(StepSemantics m loc q t tdest act, BoundedConfiguration m,
 Refusable act) =&gt;
(AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; act
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
</span><a href="#local-6989586621679297774"><span class="hs-identifier hs-var hs-var">makeUpdate</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679297820"><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297820"><span class="hs-identifier hs-var">spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679297821"><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297821"><span class="hs-identifier hs-var">testController</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679297822"><span class="annot"><span class="annottext">act
</span><a href="#local-6989586621679297822"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-122"></span><span>            </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679297836"><span class="annot"><span class="annottext">spec' :: AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297836"><span class="hs-identifier hs-var hs-var">spec'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297820"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
-&gt; act -&gt; AutIntrpr m loc q t tdest act
forall (m :: * -&gt; *) loc q t tdest act.
StepSemantics m loc q t tdest act =&gt;
AutIntrpr m loc q t tdest act
-&gt; act -&gt; AutIntrpr m loc q t tdest act
</span><a href="Lattest.Model.Automaton.html#after"><span class="hs-operator hs-var">`after`</span></a></span><span> </span><span class="annot"><span class="annottext">act
</span><a href="#local-6989586621679297822"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span>
</span><span id="line-123"></span><span>            </span><span id="local-6989586621679297837"><span class="annot"><span class="annottext">Either (m q) AutomatonException
</span><a href="#local-6989586621679297837"><span class="hs-identifier hs-var">confOrAutomatonException</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">m q -&gt; IO (Either (m q) AutomatonException)
forall a. a -&gt; IO (Either a AutomatonException)
</span><a href="Lattest.Exec.Testing.html#catchAutomatonException"><span class="hs-identifier hs-var">catchAutomatonException</span></a></span><span> </span><span class="annot"><span class="annottext">(m q -&gt; IO (Either (m q) AutomatonException))
-&gt; m q -&gt; IO (Either (m q) AutomatonException)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act -&gt; m q
forall {k} (m :: * -&gt; *) loc q t tdest (act :: k).
AutIntrpr m loc q t tdest act -&gt; m q
</span><a href="Lattest.Model.Automaton.html#stateConf"><span class="hs-identifier hs-var">stateConf</span></a></span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297836"><span class="hs-identifier hs-var">spec'</span></a></span><span>
</span><span id="line-124"></span><span>            </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (m q) AutomatonException
</span><a href="#local-6989586621679297837"><span class="hs-identifier hs-var">confOrAutomatonException</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-125"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679297839"><span class="annot"><span class="annottext">m q
</span><a href="#local-6989586621679297839"><span class="hs-identifier hs-var">conf'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-126"></span><span>                    </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679297842"><span class="annot"><span class="annottext">verdict :: Verdict
</span><a href="#local-6989586621679297842"><span class="hs-identifier hs-var hs-var">verdict</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">m q -&gt; act -&gt; Verdict
forall {k} (m :: k -&gt; *) act (x :: k).
(BoundedConfiguration m, Refusable act) =&gt;
m x -&gt; act -&gt; Verdict
</span><a href="#local-6989586621679297843"><span class="hs-identifier hs-var">actToVerd</span></a></span><span> </span><span class="annot"><span class="annottext">m q
</span><a href="#local-6989586621679297839"><span class="hs-identifier hs-var">conf'</span></a></span><span> </span><span class="annot"><span class="annottext">act
</span><a href="#local-6989586621679297822"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-127"></span><span>                    </span><span id="local-6989586621679297844"><span class="annot"><span class="annottext">Either state r
</span><a href="#local-6989586621679297844"><span class="hs-identifier hs-var">next</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
-&gt; state
-&gt; AutIntrpr m loc q t tdest act
-&gt; act
-&gt; m q
-&gt; IO (Either state r)
forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r
-&gt; state
-&gt; AutIntrpr m loc q t tdest act
-&gt; act
-&gt; m q
-&gt; IO (Either state r)
</span><a href="Lattest.Exec.Testing.html#updateTestController"><span class="hs-identifier hs-var">updateTestController</span></a></span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297821"><span class="hs-identifier hs-var">testController</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r -&gt; state
forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r -&gt; state
</span><a href="Lattest.Exec.Testing.html#testControllerState"><span class="hs-identifier hs-var">testControllerState</span></a></span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297821"><span class="hs-identifier hs-var">testController</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297836"><span class="hs-identifier hs-var">spec'</span></a></span><span> </span><span class="annot"><span class="annottext">act
</span><a href="#local-6989586621679297822"><span class="hs-identifier hs-var">act</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act -&gt; m q
forall {k} (m :: * -&gt; *) loc q t tdest (act :: k).
AutIntrpr m loc q t tdest act -&gt; m q
</span><a href="Lattest.Model.Automaton.html#stateConf"><span class="hs-identifier hs-var">stateConf</span></a></span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297820"><span class="hs-identifier hs-var">spec</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>                    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either state r
</span><a href="#local-6989586621679297844"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-129"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679297845"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297845"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either
  (AutIntrpr m loc q t tdest act,
   TestController m loc q t tdest act state i r)
  (Verdict, r)
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either
   (AutIntrpr m loc q t tdest act,
    TestController m loc q t tdest act state i r)
   (Verdict, r)
 -&gt; IO
      (Either
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r)
         (Verdict, r)))
-&gt; Either
     (AutIntrpr m loc q t tdest act,
      TestController m loc q t tdest act state i r)
     (Verdict, r)
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Verdict, r)
-&gt; Either
     (AutIntrpr m loc q t tdest act,
      TestController m loc q t tdest act state i r)
     (Verdict, r)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Verdict
</span><a href="#local-6989586621679297842"><span class="hs-identifier hs-var">verdict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297845"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-130"></span><span>                        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679297846"><span class="annot"><span class="annottext">state
</span><a href="#local-6989586621679297846"><span class="hs-identifier hs-var">state'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">m q -&gt; Bool
forall {k} (m :: k -&gt; *) (t :: k).
BoundedConfiguration m =&gt;
m t -&gt; Bool
</span><a href="Lattest.Model.BoundedMonad.html#isConclusive"><span class="hs-identifier hs-var">isConclusive</span></a></span><span> </span><span class="annot"><span class="annottext">m q
</span><a href="#local-6989586621679297839"><span class="hs-identifier hs-var">conf'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Verdict
</span><a href="#local-6989586621679297842"><span class="hs-identifier hs-var">verdict</span></a></span><span> </span><span class="annot"><span class="annottext">Verdict -&gt; Verdict -&gt; Bool
forall a. Eq a =&gt; a -&gt; a -&gt; Bool
</span><span class="hs-operator hs-var">==</span></span><span> </span><span class="annot"><span class="annottext">Verdict
</span><a href="Lattest.Exec.Testing.html#Fail"><span class="hs-identifier hs-var">Fail</span></a></span><span>
</span><span id="line-131"></span><span>                            </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-132"></span><span>                                </span><span id="local-6989586621679297848"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297848"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r -&gt; state -&gt; IO r
forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r -&gt; state -&gt; IO r
</span><a href="Lattest.Exec.Testing.html#handleTestClose"><span class="hs-identifier hs-var">handleTestClose</span></a></span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297821"><span class="hs-identifier hs-var">testController</span></a></span><span> </span><span class="annot"><span class="annottext">state
</span><a href="#local-6989586621679297846"><span class="hs-identifier hs-var">state'</span></a></span><span>
</span><span id="line-133"></span><span>                                </span><span class="annot"><span class="annottext">Either
  (AutIntrpr m loc q t tdest act,
   TestController m loc q t tdest act state i r)
  (Verdict, r)
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either
   (AutIntrpr m loc q t tdest act,
    TestController m loc q t tdest act state i r)
   (Verdict, r)
 -&gt; IO
      (Either
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r)
         (Verdict, r)))
-&gt; Either
     (AutIntrpr m loc q t tdest act,
      TestController m loc q t tdest act state i r)
     (Verdict, r)
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Verdict, r)
-&gt; Either
     (AutIntrpr m loc q t tdest act,
      TestController m loc q t tdest act state i r)
     (Verdict, r)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Verdict
</span><a href="#local-6989586621679297842"><span class="hs-identifier hs-var">verdict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297848"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-134"></span><span>                            </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Either
  (AutIntrpr m loc q t tdest act,
   TestController m loc q t tdest act state i r)
  (Verdict, r)
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either
   (AutIntrpr m loc q t tdest act,
    TestController m loc q t tdest act state i r)
   (Verdict, r)
 -&gt; IO
      (Either
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r)
         (Verdict, r)))
-&gt; Either
     (AutIntrpr m loc q t tdest act,
      TestController m loc q t tdest act state i r)
     (Verdict, r)
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; Either
     (AutIntrpr m loc q t tdest act,
      TestController m loc q t tdest act state i r)
     (Verdict, r)
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297836"><span class="hs-identifier hs-var">spec'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297821"><span class="hs-identifier hs-var">testController</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#testControllerState"><span class="hs-identifier hs-var">testControllerState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679297846"><span class="hs-identifier hs-type">state'</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span>
</span><span id="line-135"></span><span>                </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679297849"><span class="annot"><span class="annottext">AutomatonException
</span><a href="#local-6989586621679297849"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-136"></span><span>                    </span><span id="local-6989586621679297850"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297850"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r -&gt; state -&gt; IO r
forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r -&gt; state -&gt; IO r
</span><a href="Lattest.Exec.Testing.html#handleTestClose"><span class="hs-identifier hs-var">handleTestClose</span></a></span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297821"><span class="hs-identifier hs-var">testController</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r -&gt; state
forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r -&gt; state
</span><a href="Lattest.Exec.Testing.html#testControllerState"><span class="hs-identifier hs-var">testControllerState</span></a></span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297821"><span class="hs-identifier hs-var">testController</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-137"></span><span>                    </span><span class="annot"><span class="annottext">Either
  (AutIntrpr m loc q t tdest act,
   TestController m loc q t tdest act state i r)
  (Verdict, r)
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either
   (AutIntrpr m loc q t tdest act,
    TestController m loc q t tdest act state i r)
   (Verdict, r)
 -&gt; IO
      (Either
         (AutIntrpr m loc q t tdest act,
          TestController m loc q t tdest act state i r)
         (Verdict, r)))
-&gt; Either
     (AutIntrpr m loc q t tdest act,
      TestController m loc q t tdest act state i r)
     (Verdict, r)
-&gt; IO
     (Either
        (AutIntrpr m loc q t tdest act,
         TestController m loc q t tdest act state i r)
        (Verdict, r))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">(Verdict, r)
-&gt; Either
     (AutIntrpr m loc q t tdest act,
      TestController m loc q t tdest act state i r)
     (Verdict, r)
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">InconclusiveReason -&gt; Verdict
</span><a href="Lattest.Exec.Testing.html#Inconclusive"><span class="hs-identifier hs-var">Inconclusive</span></a></span><span> </span><span class="annot"><span class="annottext">(InconclusiveReason -&gt; Verdict) -&gt; InconclusiveReason -&gt; Verdict
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AutomatonException -&gt; InconclusiveReason
</span><a href="Lattest.Exec.Testing.html#AutomatonException"><span class="hs-identifier hs-var">AutomatonException</span></a></span><span> </span><span class="annot"><span class="annottext">AutomatonException
</span><a href="#local-6989586621679297849"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297850"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-138"></span><span>        </span><span id="local-6989586621679297505"><span id="local-6989586621679297506"><span id="local-6989586621679297507"><span id="local-6989586621679297508"><span id="local-6989586621679297509"><span id="local-6989586621679297510"><span id="local-6989586621679297511"><span id="local-6989586621679297512"><span id="local-6989586621679297513"><span class="annot"><a href="#local-6989586621679297775"><span class="hs-identifier hs-type">makeHandleClose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.BoundedMonad.html#BoundedConfiguration"><span class="hs-identifier hs-type">BoundedConfiguration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297505"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Automaton.html#AutIntrpr"><span class="hs-identifier hs-type">AutIntrpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297505"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297506"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297507"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297508"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297509"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297510"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#TestController"><span class="hs-identifier hs-type">TestController</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297505"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297506"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297507"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297508"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297509"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297510"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297511"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297512"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297513"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Exec.Testing.html#Verdict"><span class="hs-identifier hs-type">Verdict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679297513"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-139"></span><span>        </span><span id="local-6989586621679297775"><span class="annot"><span class="annottext">makeHandleClose :: forall (m :: * -&gt; *) loc q t tdest act state i r.
BoundedConfiguration m =&gt;
(AutIntrpr m loc q t tdest act,
 TestController m loc q t tdest act state i r)
-&gt; IO (Verdict, r)
</span><a href="#local-6989586621679297775"><span class="hs-identifier hs-var hs-var">makeHandleClose</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679297855"><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297855"><span class="hs-identifier hs-var">spec</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679297856"><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297856"><span class="hs-identifier hs-var">testController</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-140"></span><span>            </span><span id="local-6989586621679297857"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297857"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r -&gt; state -&gt; IO r
forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r -&gt; state -&gt; IO r
</span><a href="Lattest.Exec.Testing.html#handleTestClose"><span class="hs-identifier hs-var">handleTestClose</span></a></span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297856"><span class="hs-identifier hs-var">testController</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r -&gt; state
forall (m :: * -&gt; *) loc q t tdest act state i r.
TestController m loc q t tdest act state i r -&gt; state
</span><a href="Lattest.Exec.Testing.html#testControllerState"><span class="hs-identifier hs-var">testControllerState</span></a></span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297856"><span class="hs-identifier hs-var">testController</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-141"></span><span>            </span><span class="annot"><span class="annottext">(Verdict, r) -&gt; IO (Verdict, r)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">m q -&gt; Verdict
forall {k} (m :: k -&gt; *) (x :: k).
BoundedConfiguration m =&gt;
m x -&gt; Verdict
</span><a href="#local-6989586621679297787"><span class="hs-identifier hs-var">pToVerd</span></a></span><span> </span><span class="annot"><span class="annottext">(m q -&gt; Verdict) -&gt; m q -&gt; Verdict
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act -&gt; m q
forall {k} (m :: * -&gt; *) loc q t tdest (act :: k).
AutIntrpr m loc q t tdest act -&gt; m q
</span><a href="Lattest.Model.Automaton.html#stateConf"><span class="hs-identifier hs-var">stateConf</span></a></span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297855"><span class="hs-identifier hs-var">spec</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297857"><span class="hs-identifier hs-var">r</span></a></span><span class="hs-special">)</span><span> </span><span>
</span><span id="line-142"></span><span>        </span><span id="local-6989586621679297537"><span id="local-6989586621679297538"><span class="annot"><a href="#local-6989586621679297787"><span class="hs-identifier hs-type">pToVerd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.BoundedMonad.html#BoundedConfiguration"><span class="hs-identifier hs-type">BoundedConfiguration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297537"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679297537"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297538"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#Verdict"><span class="hs-identifier hs-type">Verdict</span></a></span></span></span><span>
</span><span id="line-143"></span><span>        </span><span id="local-6989586621679297787"><span class="annot"><span class="annottext">pToVerd :: forall {k} (m :: k -&gt; *) (x :: k).
BoundedConfiguration m =&gt;
m x -&gt; Verdict
</span><a href="#local-6989586621679297787"><span class="hs-identifier hs-var hs-var">pToVerd</span></a></span></span><span> </span><span id="local-6989586621679297860"><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621679297860"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">m x -&gt; Bool
forall (t :: k). m t -&gt; Bool
forall {k} (m :: k -&gt; *) (t :: k).
BoundedConfiguration m =&gt;
m t -&gt; Bool
</span><a href="Lattest.Model.BoundedMonad.html#isForbidden"><span class="hs-identifier hs-var">isForbidden</span></a></span><span> </span><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621679297860"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Verdict
</span><a href="Lattest.Exec.Testing.html#Fail"><span class="hs-identifier hs-var">Fail</span></a></span><span>
</span><span id="line-144"></span><span>                  </span><span class="hs-glyph">|</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">otherwise</span></span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Verdict
</span><a href="Lattest.Exec.Testing.html#Pass"><span class="hs-identifier hs-var">Pass</span></a></span><span>
</span><span id="line-145"></span><span>        </span><span id="local-6989586621679297569"><span id="local-6989586621679297570"><span id="local-6989586621679297571"><span class="annot"><a href="#local-6989586621679297843"><span class="hs-identifier hs-type">actToVerd</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.BoundedMonad.html#BoundedConfiguration"><span class="hs-identifier hs-type">BoundedConfiguration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297569"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.Alphabet.html#Refusable"><span class="hs-identifier hs-type">Refusable</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297570"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679297569"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297571"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679297570"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#Verdict"><span class="hs-identifier hs-type">Verdict</span></a></span></span></span></span><span>
</span><span id="line-146"></span><span>        </span><span id="local-6989586621679297843"><span class="annot"><span class="annottext">actToVerd :: forall {k} (m :: k -&gt; *) act (x :: k).
(BoundedConfiguration m, Refusable act) =&gt;
m x -&gt; act -&gt; Verdict
</span><a href="#local-6989586621679297843"><span class="hs-identifier hs-var hs-var">actToVerd</span></a></span></span><span> </span><span id="local-6989586621679297865"><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621679297865"><span class="hs-identifier hs-var">p</span></a></span></span><span> </span><span id="local-6989586621679297866"><span class="annot"><span class="annottext">act
</span><a href="#local-6989586621679297866"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">m x -&gt; Verdict
forall {k} (m :: k -&gt; *) (x :: k).
BoundedConfiguration m =&gt;
m x -&gt; Verdict
</span><a href="#local-6989586621679297787"><span class="hs-identifier hs-var">pToVerd</span></a></span><span> </span><span class="annot"><span class="annottext">m x
</span><a href="#local-6989586621679297865"><span class="hs-identifier hs-var">p</span></a></span><span> </span><span class="hs-keyword">of</span><span> </span><span class="hs-comment">-- this is effectively just &amp;&amp; between two verdicts, one from the observed action and one from the state configuration</span><span>
</span><span id="line-147"></span><span>            </span><span class="annot"><span class="annottext">Verdict
</span><a href="Lattest.Exec.Testing.html#Fail"><span class="hs-identifier hs-var">Fail</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Verdict
</span><a href="Lattest.Exec.Testing.html#Fail"><span class="hs-identifier hs-var">Fail</span></a></span><span>
</span><span id="line-148"></span><span>            </span><span class="annot"><span class="annottext">Verdict
</span><a href="Lattest.Exec.Testing.html#Pass"><span class="hs-identifier hs-var">Pass</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span>  </span><span class="hs-special">(</span><span class="annot"><span class="annottext">act -&gt; Bool
forall act. Refusable act =&gt; act -&gt; Bool
</span><a href="Lattest.Model.Alphabet.html#isAccepted"><span class="hs-identifier hs-var">isAccepted</span></a></span><span> </span><span class="annot"><span class="annottext">act
</span><a href="#local-6989586621679297866"><span class="hs-identifier hs-var">act</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Verdict
</span><a href="Lattest.Exec.Testing.html#Pass"><span class="hs-identifier hs-var">Pass</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Verdict
</span><a href="Lattest.Exec.Testing.html#Fail"><span class="hs-identifier hs-var">Fail</span></a></span><span>
</span><span id="line-149"></span><span>
</span><span id="line-150"></span><span id="local-6989586621679297567"><span class="annot"><a href="Lattest.Exec.Testing.html#catchAutomatonException"><span class="hs-identifier hs-type">catchAutomatonException</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679297567"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Either</span></span><span> </span><span class="annot"><a href="#local-6989586621679297567"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="Lattest.Model.Automaton.html#AutomatonException"><span class="hs-identifier hs-type">AutomatonException</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-151"></span><span id="catchAutomatonException"><span class="annot"><span class="annottext">catchAutomatonException :: forall a. a -&gt; IO (Either a AutomatonException)
</span><a href="Lattest.Exec.Testing.html#catchAutomatonException"><span class="hs-identifier hs-var hs-var">catchAutomatonException</span></a></span></span><span> </span><span id="local-6989586621679297872"><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679297872"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Either a AutomatonException
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">(a -&gt; Either a AutomatonException)
-&gt; IO a -&gt; IO (Either a AutomatonException)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; IO a
forall a. a -&gt; IO a
</span><span class="hs-identifier hs-var">evaluate</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679297872"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">IO (Either a AutomatonException)
-&gt; (AutomatonException -&gt; IO (Either a AutomatonException))
-&gt; IO (Either a AutomatonException)
forall e a. Exception e =&gt; IO a -&gt; (e -&gt; IO a) -&gt; IO a
</span><span class="hs-operator hs-var">`catch`</span></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span id="local-6989586621679297874"><span class="annot"><span class="annottext">AutomatonException
</span><a href="#local-6989586621679297874"><span class="hs-identifier hs-var">e</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either a AutomatonException -&gt; IO (Either a AutomatonException)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either a AutomatonException -&gt; IO (Either a AutomatonException))
-&gt; Either a AutomatonException -&gt; IO (Either a AutomatonException)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">AutomatonException -&gt; Either a AutomatonException
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">AutomatonException
</span><a href="#local-6989586621679297874"><span class="hs-identifier hs-var">e</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-152"></span><span>
</span><span id="line-153"></span><span class="annot"><span class="hs-comment">{- |
    Run an experiment by interacting with the given adapter, controlled by the given action controller. The experiment
    stops when the action controller decides to. Returns the result returned by the action controller.
-}</span></span><span>
</span><span id="line-157"></span><span id="local-6989586621679297602"><span id="local-6989586621679297603"><span id="local-6989586621679297604"><span id="local-6989586621679297605"><span class="annot"><a href="Lattest.Exec.Testing.html#runExperiment"><span class="hs-identifier hs-type">runExperiment</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#ActionController"><span class="hs-identifier hs-type">ActionController</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297602"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297603"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297604"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297605"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lattest.Adapter.Adapter.html#Adapter"><span class="hs-identifier hs-type">Adapter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297602"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297603"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="annot"><a href="#local-6989586621679297604"><span class="hs-identifier hs-type">r</span></a></span></span></span></span></span><span>
</span><span id="line-158"></span><span id="runExperiment"><span class="annot"><span class="annottext">runExperiment :: forall act i r state.
ActionController act i r state -&gt; Adapter act i -&gt; IO r
</span><a href="Lattest.Exec.Testing.html#runExperiment"><span class="hs-identifier hs-var hs-var">runExperiment</span></a></span></span><span> </span><span id="local-6989586621679297878"><span class="annot"><span class="annottext">ActionController act i r state
</span><a href="#local-6989586621679297878"><span class="hs-identifier hs-var">controller</span></a></span></span><span> </span><span id="local-6989586621679297879"><span class="annot"><span class="annottext">Adapter act i
</span><a href="#local-6989586621679297879"><span class="hs-identifier hs-var">adapter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-159"></span><span>    </span><span id="local-6989586621679297880"><span class="annot"><span class="annottext">Streamed act
</span><a href="#local-6989586621679297880"><span class="hs-identifier hs-var">streamedAction</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">Adapter act i -&gt; IO (Streamed act)
forall act i. Adapter act i -&gt; IO (Streamed act)
</span><a href="Lattest.Adapter.Adapter.html#tryObserve"><span class="hs-identifier hs-var">tryObserve</span></a></span><span> </span><span class="annot"><span class="annottext">Adapter act i
</span><a href="#local-6989586621679297879"><span class="hs-identifier hs-var">adapter</span></a></span><span>
</span><span id="line-160"></span><span>    </span><span id="local-6989586621679297881"><span class="annot"><span class="annottext">Either state r
</span><a href="#local-6989586621679297881"><span class="hs-identifier hs-var">stateOrResult</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Streamed act
</span><a href="#local-6989586621679297880"><span class="hs-identifier hs-var">streamedAction</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-161"></span><span>        </span><span class="annot"><a href="System.IO.Streams.Synchronized.html#Available"><span class="hs-identifier hs-type">Available</span></a></span><span> </span><span id="local-6989586621679297883"><span class="annot"><span class="annottext">act
</span><a href="#local-6989586621679297883"><span class="hs-identifier hs-var">action</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">act -&gt; IO (Either state r)
</span><a href="#local-6989586621679297884"><span class="hs-identifier hs-var">handleUpdate</span></a></span><span> </span><span class="annot"><span class="annottext">act
</span><a href="#local-6989586621679297883"><span class="hs-identifier hs-var">action</span></a></span><span>
</span><span id="line-162"></span><span>        </span><span class="annot"><span class="annottext">Streamed act
</span><a href="System.IO.Streams.Synchronized.html#Unavailable"><span class="hs-identifier hs-var">Unavailable</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Either state r)
</span><a href="#local-6989586621679297886"><span class="hs-identifier hs-var">handleSelect</span></a></span><span>
</span><span id="line-163"></span><span>        </span><span class="annot"><span class="annottext">Streamed act
</span><a href="System.IO.Streams.Synchronized.html#StreamClosed"><span class="hs-identifier hs-var">StreamClosed</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">IO (Either state r)
forall {a}. IO (Either a r)
</span><a href="#local-6989586621679297888"><span class="hs-identifier hs-var">handleClosed</span></a></span><span>
</span><span id="line-164"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either state r
</span><a href="#local-6989586621679297881"><span class="hs-identifier hs-var">stateOrResult</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-165"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span id="local-6989586621679297889"><span class="annot"><span class="annottext">state
</span><a href="#local-6989586621679297889"><span class="hs-identifier hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">ActionController act i r state -&gt; Adapter act i -&gt; IO r
forall act i r state.
ActionController act i r state -&gt; Adapter act i -&gt; IO r
</span><a href="Lattest.Exec.Testing.html#runExperiment"><span class="hs-identifier hs-var">runExperiment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionController act i r state
</span><a href="#local-6989586621679297878"><span class="hs-identifier hs-var">controller</span></a></span><span> </span><span class="hs-special">{</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#controllerState"><span class="hs-identifier hs-var">controllerState</span></a></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><a href="#local-6989586621679297889"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="hs-special">}</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Adapter act i
</span><a href="#local-6989586621679297879"><span class="hs-identifier hs-var">adapter</span></a></span><span>
</span><span id="line-166"></span><span>        </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679297890"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297890"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">r -&gt; IO r
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297890"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-167"></span><span>    </span><span class="hs-keyword">where</span><span> </span><span>
</span><span id="line-168"></span><span>    </span><span id="local-6989586621679297884"><span class="annot"><span class="annottext">handleUpdate :: act -&gt; IO (Either state r)
</span><a href="#local-6989586621679297884"><span class="hs-identifier hs-var hs-var">handleUpdate</span></a></span></span><span> </span><span id="local-6989586621679297891"><span class="annot"><span class="annottext">act
</span><a href="#local-6989586621679297891"><span class="hs-identifier hs-var">act</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionController act i r state
-&gt; state -&gt; act -&gt; IO (Either state r)
forall act i r state.
ActionController act i r state
-&gt; state -&gt; act -&gt; IO (Either state r)
</span><a href="Lattest.Exec.Testing.html#update"><span class="hs-identifier hs-var">update</span></a></span><span> </span><span class="annot"><span class="annottext">ActionController act i r state
</span><a href="#local-6989586621679297878"><span class="hs-identifier hs-var">controller</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionController act i r state -&gt; state
forall act i r state. ActionController act i r state -&gt; state
</span><a href="Lattest.Exec.Testing.html#controllerState"><span class="hs-identifier hs-var">controllerState</span></a></span><span> </span><span class="annot"><span class="annottext">ActionController act i r state
</span><a href="#local-6989586621679297878"><span class="hs-identifier hs-var">controller</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">act
</span><a href="#local-6989586621679297891"><span class="hs-identifier hs-var">act</span></a></span><span>
</span><span id="line-169"></span><span>    </span><span id="local-6989586621679297886"><span class="annot"><span class="annottext">handleSelect :: IO (Either state r)
</span><a href="#local-6989586621679297886"><span class="hs-identifier hs-var hs-var">handleSelect</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-170"></span><span>        </span><span id="local-6989586621679297896"><span class="annot"><span class="annottext">Either (i, state) r
</span><a href="#local-6989586621679297896"><span class="hs-identifier hs-var">selection</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionController act i r state -&gt; state -&gt; IO (Either (i, state) r)
forall act i r state.
ActionController act i r state -&gt; state -&gt; IO (Either (i, state) r)
</span><a href="Lattest.Exec.Testing.html#select"><span class="hs-identifier hs-var">select</span></a></span><span> </span><span class="annot"><span class="annottext">ActionController act i r state
</span><a href="#local-6989586621679297878"><span class="hs-identifier hs-var">controller</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionController act i r state -&gt; state
forall act i r state. ActionController act i r state -&gt; state
</span><a href="Lattest.Exec.Testing.html#controllerState"><span class="hs-identifier hs-var">controllerState</span></a></span><span> </span><span class="annot"><span class="annottext">ActionController act i r state
</span><a href="#local-6989586621679297878"><span class="hs-identifier hs-var">controller</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-171"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Either (i, state) r
</span><a href="#local-6989586621679297896"><span class="hs-identifier hs-var">selection</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-172"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Left</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679297897"><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679297897"><span class="hs-identifier hs-var">inputCmd</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679297898"><span class="annot"><span class="annottext">state
</span><a href="#local-6989586621679297898"><span class="hs-identifier hs-var">state</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-173"></span><span>                 </span><span class="hs-comment">-- TODO if an action is ready *after computing the input command* (because race condition between the adapter and controller), maybe don't send the input command.</span><span>
</span><span id="line-174"></span><span>                </span><span class="annot"><span class="annottext">i -&gt; Adapter act i -&gt; IO ()
forall i act. i -&gt; Adapter act i -&gt; IO ()
</span><a href="Lattest.Adapter.Adapter.html#send"><span class="hs-identifier hs-var">send</span></a></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679297897"><span class="hs-identifier hs-var">inputCmd</span></a></span><span> </span><span class="annot"><span class="annottext">Adapter act i
</span><a href="#local-6989586621679297879"><span class="hs-identifier hs-var">adapter</span></a></span><span>
</span><span id="line-175"></span><span>                </span><span class="annot"><span class="annottext">Either state r -&gt; IO (Either state r)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either state r -&gt; IO (Either state r))
-&gt; Either state r -&gt; IO (Either state r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">state -&gt; Either state r
forall a b. a -&gt; Either a b
</span><span class="hs-identifier hs-var">Left</span></span><span> </span><span class="annot"><span class="annottext">state
</span><a href="#local-6989586621679297898"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-176"></span><span>            </span><span class="annot"><span class="hs-identifier hs-type">Right</span></span><span> </span><span id="local-6989586621679297899"><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297899"><span class="hs-identifier hs-var">result</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Either state r -&gt; IO (Either state r)
forall a. a -&gt; IO a
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Either state r -&gt; IO (Either state r))
-&gt; Either state r -&gt; IO (Either state r)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">r -&gt; Either state r
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">r
</span><a href="#local-6989586621679297899"><span class="hs-identifier hs-var">result</span></a></span><span>
</span><span id="line-177"></span><span>    </span><span id="local-6989586621679297888"><span class="annot"><span class="annottext">handleClosed :: IO (Either a r)
</span><a href="#local-6989586621679297888"><span class="hs-identifier hs-var hs-var">handleClosed</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">r -&gt; Either a r
forall a b. b -&gt; Either a b
</span><span class="hs-identifier hs-var">Right</span></span><span> </span><span class="annot"><span class="annottext">(r -&gt; Either a r) -&gt; IO r -&gt; IO (Either a r)
forall (f :: * -&gt; *) a b. Functor f =&gt; (a -&gt; b) -&gt; f a -&gt; f b
</span><span class="hs-operator hs-var">&lt;$&gt;</span></span><span> </span><span class="annot"><span class="annottext">ActionController act i r state -&gt; state -&gt; IO r
forall act i r state.
ActionController act i r state -&gt; state -&gt; IO r
</span><a href="Lattest.Exec.Testing.html#handleClose"><span class="hs-identifier hs-var">handleClose</span></a></span><span> </span><span class="annot"><span class="annottext">ActionController act i r state
</span><a href="#local-6989586621679297878"><span class="hs-identifier hs-var">controller</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">ActionController act i r state -&gt; state
forall act i r state. ActionController act i r state -&gt; state
</span><a href="Lattest.Exec.Testing.html#controllerState"><span class="hs-identifier hs-var">controllerState</span></a></span><span> </span><span class="annot"><span class="annottext">ActionController act i r state
</span><a href="#local-6989586621679297878"><span class="hs-identifier hs-var">controller</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-178"></span><span>
</span><span id="line-179"></span><span class="annot"><span class="hs-comment">{- |
    Running a tester requires:
    
    * a specification model in the form of an automaton, as defined in &quot;Lattest.Model.Automaton&quot;
    * a 'TestController', defined in this module itself, and
    * an adapter, as defined in &quot;Lattest.Adapter.Adapter&quot;.

    Running a testing experiment is done by interacting with the given adapter, controlled by the given test controller. The experiment
    stops when the action controller decides to, or when an observation is made that is forbidden or underspecified according
    to the specification model. Returns the test verdict according to the specification model and the additional
    result returned by the test controller.
-}</span></span><span>
</span><span id="line-191"></span><span id="local-6989586621679297617"><span id="local-6989586621679297618"><span id="local-6989586621679297619"><span id="local-6989586621679297620"><span id="local-6989586621679297621"><span id="local-6989586621679297622"><span id="local-6989586621679297623"><span id="local-6989586621679297624"><span id="local-6989586621679297625"><span class="annot"><a href="Lattest.Exec.Testing.html#runTester"><span class="hs-identifier hs-type">runTester</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Model.Automaton.html#StepSemantics"><span class="hs-identifier hs-type">StepSemantics</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297617"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297618"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297619"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297620"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297621"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297622"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.Alphabet.html#TestChoice"><span class="hs-identifier hs-type">TestChoice</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297623"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297622"><span class="hs-identifier hs-type">act</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Lattest.Model.BoundedMonad.html#BoundedConfiguration"><span class="hs-identifier hs-type">BoundedConfiguration</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297617"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>
</span><span id="line-192"></span><span>    </span><span class="annot"><a href="Lattest.Model.Automaton.html#AutIntrpr"><span class="hs-identifier hs-type">AutIntrpr</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297617"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297618"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297619"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297620"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297621"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297622"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lattest.Exec.Testing.html#TestController"><span class="hs-identifier hs-type">TestController</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297617"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297618"><span class="hs-identifier hs-type">loc</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297619"><span class="hs-identifier hs-type">q</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297620"><span class="hs-identifier hs-type">t</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297621"><span class="hs-identifier hs-type">tdest</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297622"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297624"><span class="hs-identifier hs-type">state</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297623"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297625"><span class="hs-identifier hs-type">r</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Lattest.Adapter.Adapter.html#Adapter"><span class="hs-identifier hs-type">Adapter</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297622"><span class="hs-identifier hs-type">act</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679297623"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">IO</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Lattest.Exec.Testing.html#Verdict"><span class="hs-identifier hs-type">Verdict</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679297625"><span class="hs-identifier hs-type">r</span></a></span><span class="hs-special">)</span></span></span></span></span></span></span></span></span></span><span>
</span><span id="line-193"></span><span id="runTester"><span class="annot"><span class="annottext">runTester :: forall (m :: * -&gt; *) loc q t tdest act i state r.
(StepSemantics m loc q t tdest act, TestChoice i act,
 BoundedConfiguration m) =&gt;
AutIntrpr m loc q t tdest act
-&gt; TestController m loc q t tdest act state i r
-&gt; Adapter act i
-&gt; IO (Verdict, r)
</span><a href="Lattest.Exec.Testing.html#runTester"><span class="hs-identifier hs-var hs-var">runTester</span></a></span></span><span> </span><span id="local-6989586621679297907"><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297907"><span class="hs-identifier hs-var">spec</span></a></span></span><span> </span><span id="local-6989586621679297908"><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297908"><span class="hs-identifier hs-var">testSelection</span></a></span></span><span> </span><span id="local-6989586621679297909"><span class="annot"><span class="annottext">Adapter act i
</span><a href="#local-6989586621679297909"><span class="hs-identifier hs-var">adapter</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">ActionController
  act
  i
  (Verdict, r)
  (AutIntrpr m loc q t tdest act,
   TestController m loc q t tdest act state i r)
-&gt; Adapter act i -&gt; IO (Verdict, r)
forall act i r state.
ActionController act i r state -&gt; Adapter act i -&gt; IO r
</span><a href="Lattest.Exec.Testing.html#runExperiment"><span class="hs-identifier hs-var">runExperiment</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
-&gt; TestController m loc q t tdest act state i r
-&gt; ActionController
     act
     i
     (Verdict, r)
     (AutIntrpr m loc q t tdest act,
      TestController m loc q t tdest act state i r)
forall (m :: * -&gt; *) loc q t tdest act i state r.
(StepSemantics m loc q t tdest act, TestChoice i act,
 BoundedConfiguration m) =&gt;
AutIntrpr m loc q t tdest act
-&gt; TestController m loc q t tdest act state i r
-&gt; ActionController
     act
     i
     (Verdict, r)
     (AutIntrpr m loc q t tdest act,
      TestController m loc q t tdest act state i r)
</span><a href="Lattest.Exec.Testing.html#makeTester"><span class="hs-identifier hs-var">makeTester</span></a></span><span> </span><span class="annot"><span class="annottext">AutIntrpr m loc q t tdest act
</span><a href="#local-6989586621679297907"><span class="hs-identifier hs-var">spec</span></a></span><span> </span><span class="annot"><span class="annottext">TestController m loc q t tdest act state i r
</span><a href="#local-6989586621679297908"><span class="hs-identifier hs-var">testSelection</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Adapter act i
</span><a href="#local-6989586621679297909"><span class="hs-identifier hs-var">adapter</span></a></span><span>
</span><span id="line-194"></span><span>
</span><span id="line-195"></span><span class="hs-comment">--runStepper :: (Automaton aut c act) =&gt; aut -&gt; ActionController (Path aut c act) act r state  -&gt; IO r</span><span>
</span><span id="line-196"></span><span class="hs-comment">--runStepper spec controller = runExperiment controller (simulateSpec spec)</span><span>
</span><span id="line-197"></span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>
</span><span id="line-200"></span><span>
</span><span id="line-201"></span><span>
</span><span id="line-202"></span><span>
</span><span id="line-203"></span></pre></body></html>